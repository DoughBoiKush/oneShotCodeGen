# Backend Code

{
"files":{
"backend/.env":"PORT=3000\nDB_PATH=database.sqlite\nJWT_SECRET=friendflix_jwt_secret123",
"backend/config/database.js":"const { Sequelize } = require('sequelize');\nconst path = require('path');\nconst dbPath = path.resolve(__dirname, '..', process.env.DB_PATH);\nconst sequelize = new Sequelize({dialect: 'sqlite',storage: dbPath,logging: false});\nmodule.exports = sequelize;",
"backend/models/User.js":"const { DataTypes } = require('sequelize');\nconst sequelize = require('../config/database');\nconst User = sequelize.define('User', {\nid: {type: DataTypes.INTEGER,primaryKey: true,autoIncrement: true},\nemail: {type: DataTypes.STRING,unique: true,allowNull: false},\npassword: {type: DataTypes.STRING,allowNull: false},\nname: {type: DataTypes.STRING,allowNull: false},\nisAdmin: {type: DataTypes.BOOLEAN,defaultValue: false}\n});\nmodule.exports = User;",
"backend/models/Recommendation.js":"const { DataTypes } = require('sequelize');\nconst sequelize = require('../config/database');\nconst Recommendation = sequelize.define('Recommendation', {\nid: {type: DataTypes.INTEGER,primaryKey: true,autoIncrement: true},\ntitle: {type: DataTypes.STRING,allowNull: false},\ntype: {type: DataTypes.ENUM('movie', 'show'),allowNull: false},\ndescription: DataTypes.TEXT\n});\nmodule.exports = Recommendation;",
"backend/models/Rating.js":"const { DataTypes } = require('sequelize');\nconst sequelize = require('../config/database');\nconst Rating = sequelize.define('Rating', {\nid: {type: DataTypes.INTEGER,primaryKey: true,autoIncrement: true},\nrating: {type: DataTypes.INTEGER,allowNull: false},\nreview: DataTypes.TEXT\n});\nmodule.exports = Rating;",
"backend/models/Friendship.js":"const { DataTypes } = require('sequelize');\nconst sequelize = require('../config/database');\nconst Friendship = sequelize.define('Friendship', {\nstatus: {type: DataTypes.ENUM('pending', 'accepted'),defaultValue: 'pending'}\n});\nmodule.exports = Friendship;",
"backend/models/index.js":"const sequelize = require('../config/database');\nconst User = require('./User');\nconst Recommendation = require('./Recommendation');\nconst Rating = require('./Rating');\nconst Friendship = require('./Friendship');\nUser.hasMany(Recommendation);\nRecommendation.belongsTo(User);\nUser.hasMany(Rating);\nRating.belongsTo(User);\nRecommendation.hasMany(Rating);\nRating.belongsTo(Recommendation);\nUser.belongsToMany(User, {through: Friendship,as: 'friends',foreignKey: 'userId',otherKey: 'friendId'});\nmodule.exports = {sequelize,User,Recommendation,Rating,Friendship};",
"backend/controllers/authController.js":"const jwt = require('jsonwebtoken');\nconst bcrypt = require('bcryptjs');\nconst { User } = require('../models');\nconst login = async (req, res) => {\ntry {\nconst { email, password } = req.body;\nconst user = await User.findOne({ where: { email } });\nif (!user || !bcrypt.compareSync(password, user.password)) {\nreturn res.status(401).json({ error: 'Invalid credentials' });\n}\nconst token = jwt.sign({ id: user.id }, process.env.JWT_SECRET);\nres.json({ token, user: { id: user.id, email: user.email, name: user.name, isAdmin: user.isAdmin } });\n} catch (error) {\nres.status(500).json({ error: error.message });\n}\n};\nconst register = async (req, res) => {\ntry {\nconst { email, password, name } = req.body;\nconst hashedPassword = bcrypt.hashSync(password, 8);\nconst user = await User.create({ email, password: hashedPassword, name });\nconst token = jwt.sign({ id: user.id }, process.env.JWT_SECRET);\nres.status(201).json({ token, user: { id: user.id, email: user.email, name: user.name, isAdmin: user.isAdmin } });\n} catch (error) {\nres.status(400).json({ error: error.message });\n}\n};\nmodule.exports = { login, register };",
"backend/controllers/recommendationController.js":"const { Recommendation, User, Rating } = require('../models');\nconst create = async (req, res) => {\ntry {\nconst recommendation = await Recommendation.create({ ...req.body, UserId: req.user.id });\nres.status(201).json(recommendation);\n} catch (error) {\nres.status(400).json({ error: error.message });\n}\n};\nconst getAll = async (req, res) => {\ntry {\nconst recommendations = await Recommendation.findAll({include: [{model: User, attributes: ['name']},{model: Rating}]});\nres.json(recommendations);\n} catch (error) {\nres.status(500).json({ error: error.message });\n}\n};\nconst getFriendRecommendations = async (req, res) => {\ntry {\nconst recommendations = await Recommendation.findAll({where: { UserId: req.params.userId },include: [{model: User, attributes: ['name']},{model: Rating}]});\nres.json(recommendations);\n} catch (error) {\nres.status(500).json({ error: error.message });\n}\n};\nmodule.exports = { create, getAll, getFriendRecommendations };",
"backend/controllers/friendshipController.js":"const { User, Friendship } = require('../models');\nconst sendRequest = async (req, res) => {\ntry {\nawait Friendship.create({ userId: req.user.id, friendId: req.params.friendId });\nres.status(201).json({ message: 'Friend request sent' });\n} catch (error) {\nres.status(400).json({ error: error.message });\n}\n};\nconst acceptRequest = async (req, res) => {\ntry {\nconst friendship = await Friendship.findOne({where: {userId: req.params.userId,friendId: req.user.id,status: 'pending'}});\nif (!friendship) return res.status(404).json({ error: 'Request not found' });\nawait friendship.update({ status: 'accepted' });\nres.json({ message: 'Friend request accepted' });\n} catch (error) {\nres.status(500).json({ error: error.message });\n}\n};\nconst getFriends = async (req, res) => {\ntry {\nconst user = await User.findByPk(req.user.id, {include: [{model: User,as: 'friends',through: { where: { status: 'accepted' } }}]});\nres.json(user.friends);\n} catch (error) {\nres.status(500).json({ error: error.message });\n}\n};\nmodule.exports = { sendRequest, acceptRequest, getFriends };",
"backend/middleware/auth.js":"const jwt = require('jsonwebtoken');\nconst { User } = require('../models');\nconst auth = async (req, res, next) => {\ntry {\nconst token = req.header('Authorization').replace('Bearer ', '');\nconst decoded = jwt.verify(token, process.env.JWT_SECRET);\nconst user = await User.findByPk(decoded.id);\nif (!user) throw new Error();\nreq.user = user;\nnext();\n} catch (error) {\nres.status(401).json({ error: 'Please authenticate' });\n}\n};\nconst adminAuth = async (req, res, next) => {\ntry {\nawait auth(req, res, () => {\nif (!req.user.isAdmin) return res.status(403).json({ error: 'Admin access required' });\nnext();\n});\n} catch (error) {\nres.status(401).json({ error: 'Please authenticate' });\n}\n};\nmodule.exports = { auth, adminAuth };",
"backend/routes/auth.js":"const express = require('express');\nconst router = express.Router();\nconst { login, register } = require('../controllers/authController');\nrouter.post('/login', login);\nrouter.post('/register', register);\nmodule.exports = router;",
"backend/routes/recommendations.js":"const express = require('express');\nconst router = express.Router();\nconst { auth } = require('../middleware/auth');\nconst { create, getAll, getFriendRecommendations } = require('../controllers/recommendationController');\nrouter.post('/', auth, create);\nrouter.get('/', auth, getAll);\nrouter.get('/user/:userId', auth, getFriendRecommendations);\nmodule.exports = router;",
"backend/routes/friendships.js":"const express = require('express');\nconst router = express.Router();\nconst { auth } = require('../middleware/auth');\nconst { sendRequest, acceptRequest, getFriends } = require('../controllers/friendshipController');\nrouter.post('/request/:friendId', auth, sendRequest);\nrouter.put('/accept/:userId', auth, acceptRequest);\nrouter.get('/friends', auth, getFriends);\nmodule.exports = router;",
"backend/seeders/seed.js":"const bcrypt = require('bcryptjs');\nconst { User, Recommendation, Rating, Friendship } = require('../models');\nconst seed = async () => {\ntry {\nconst admin = await User.create({email: 'user@example.com',password: bcrypt.hashSync('test123', 8),name: 'Admin User',isAdmin: true});\nconst user1 = await User.create({email: 'user1@example.com',password: bcrypt.hashSync('password123', 8),name: 'User One'});\nconst user2 = await User.create({email: 'user2@example.com',password: bcrypt.hashSync('password123', 8),name: 'User Two'});\nconst rec1 = await Recommendation.create({title: 'Inception',type: 'movie',description: 'Mind-bending thriller',UserId: user1.id});\nconst rec2 = await Recommendation.create({title: 'Breaking Bad',type: 'show',description: 'Crime drama series',UserId: user2.id});\nawait Rating.create({rating: 5,review: 'Masterpiece!',UserId: user2.id,RecommendationId: rec1.id});\nawait Rating.create({rating: 4,review: 'Great show!',UserId: user1.id,RecommendationId: rec2.id});\nawait Friendship.create({userId: user1.id,friendId: user2.id,status: 'accepted'});\nconsole.log('Seed completed');\n} catch (error) {\nconsole.error('Seeding error:', error);\n}\n};\nmodule.exports = seed;",
"backend/server.js":"require('dotenv').config();\nconst express = require('express');\nconst cors = require('cors');\nconst { sequelize } = require('./models');\nconst seed = require('./seeders/seed');\nconst app = express();\napp.use(cors());\napp.use(express.json());\napp.use('/api/auth', require('./routes/auth'));\napp.use('/api/recommendations', require('./routes/recommendations'));\napp.use('/api/friendships', require('./routes/friendships'));\nconst PORT = process.env.PORT || 3000;\nsequelize.sync({ force: true }).then(async () => {\nawait seed();\napp.listen(PORT, () => console.log(`Server running on port ${PORT}`));\n});"
},
"commands": [
"mkdir backend",
"cd backend && npm init -y",
"cd backend && npm install express sequelize sqlite3 jsonwebtoken bcryptjs cors dotenv"
]
}